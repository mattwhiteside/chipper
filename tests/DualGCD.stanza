#include("src/firrtl-ir.stanza")
#include("src/ir-utils.stanza")
#include("src/chipper.stanza")
#use-syntax(core, chipper)

defpackage dualgcd :
   import core
   import verse
   import chipper

defbundle Dual<T> :
   a: T
   b: T

defmodule GCD :
   input in: Dual<UInt>
   input e: UInt<1>
   output z: UInt<1>
   output v: UInt<1>

   reg x: UInt
   reg y: UInt
   when x > y :
      x := x - y
   else :
      y := y - x
   when e :
      x := in.a
      y := in.b
   z := x
   v := y === UInt(0)

   wire w: UInt[10]
   w[9] := e
   w[in] := e

defn main () :
   circuit c of GCD
   println(c)
   
main()
